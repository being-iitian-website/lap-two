# Prisma Setup Guide

This project uses Prisma ORM with a PostgreSQL database. Follow this guide to configure Prisma, generate the client, and apply migrations on Windows.

## Prerequisites
- Node.js 18+ and npm installed
- A PostgreSQL instance (local install, Docker, or cloud)
- Environment file: create a `.env` in the project root

## Configure `DATABASE_URL`
Add your connection string to `.env`:

```
# Local PostgreSQL example
DATABASE_URL="postgresql://postgres:yourpassword@localhost:5432/beingiit_backend?schema=public"

# Docker example (see Database guide for docker run)
# DATABASE_URL="postgresql://postgres:yourpassword@localhost:5432/beingiit_backend?schema=public"
```

- Prisma reads the URL in [prisma/schema.prisma](prisma/schema.prisma#L12-L16).
- The Prisma client is generated by the `generator client` block in the same file.

## Install dependencies
Run once to ensure Prisma packages are installed:

```bash
npm install
```

This repo already includes Prisma in `dependencies` and runs `prisma generate` on `postinstall`.
See [package.json](package.json#L1-L200).

## Generate Prisma Client
Generate the client anytime the schema changes:

```bash
npx prisma generate
```

## Apply Migrations
This repo already contains migrations in [prisma/migrations/](prisma/migrations).
Use one of the following depending on environment:

- Development (creates missing migrations if prompted):

```bash
npx prisma migrate dev
```

- Production/CI (applies existing migrations only):

```bash
npx prisma migrate deploy
```

- Create a new migration after editing the schema:

```bash
npx prisma migrate dev --name <short-change-name>
```

## Explore Data (Prisma Studio)
Start Prisma Studio to view and edit data:

```bash
npx prisma studio
```

## Using Prisma in Code
This project centralizes the Prisma client in [src/config/prismaconfig.ts](src/config/prismaconfig.ts):

```ts
import prisma from "../config/prismaconfig";

async function example() {
  const users = await prisma.user_info.findMany();
  return users;
}
```

- `prismaconfig.ts` configures logging based on `NODE_ENV` and disconnects cleanly in production.
- Import `prisma` wherever you need DB access.

## Common Issues (Windows)
- Connection refused: verify PostgreSQL is running on port 5432 and that your firewall allows local connections.
- Authentication errors: confirm username/password and that the database exists (e.g., `beingiit_backend`).
- SSL/TLS: for local dev, most installations do not require `sslmode=require`. If using cloud DBs, adjust the URL accordingly.

## Next Steps
- Ensure `.env` is present and `DATABASE_URL` points to your PostgreSQL.
- Run `npx prisma migrate dev` then `npx prisma generate`.
- Start your app with:

```bash
npm run dev
```

Refer also to the Database Setup Guide: see [DATABASE_SETUP_GUIDE.md](DATABASE_SETUP_GUIDE.md).